{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Skill Test Suite Schema",
  "description": "JSON schema for adversarial test suites generated by skill-adversary",
  "type": "object",
  "required": ["skill_name", "skill_version", "test_suite_version", "created", "total_tests", "test_cases"],
  "properties": {
    "skill_name": {
      "type": "string",
      "description": "Name of the skill being tested",
      "pattern": "^[a-z0-9-]+$"
    },
    "skill_version": {
      "type": "string",
      "description": "Version of the skill being tested",
      "pattern": "^\\d+\\.\\d+\\.\\d+$"
    },
    "test_suite_version": {
      "type": "string",
      "description": "Version of the test suite itself",
      "pattern": "^\\d+\\.\\d+\\.\\d+$"
    },
    "created": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of initial creation"
    },
    "last_updated": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of last update"
    },
    "total_tests": {
      "type": "integer",
      "minimum": 0,
      "description": "Total number of test cases in suite"
    },
    "iteration_history": {
      "type": "array",
      "description": "History of test suite evolution across iterations",
      "items": {
        "type": "object",
        "required": ["iteration", "timestamp", "tests_added"],
        "properties": {
          "iteration": {
            "type": "integer",
            "minimum": 1
          },
          "timestamp": {
            "type": "string",
            "format": "date-time"
          },
          "tests_added": {
            "type": "integer",
            "minimum": 0
          },
          "regression_passed": {
            "type": "integer",
            "minimum": 0
          },
          "regression_failed": {
            "type": "integer",
            "minimum": 0
          },
          "new_passed": {
            "type": "integer",
            "minimum": 0
          },
          "new_failed": {
            "type": "integer",
            "minimum": 0
          },
          "total_passed": {
            "type": "integer",
            "minimum": 0
          },
          "total_failed": {
            "type": "integer",
            "minimum": 0
          }
        }
      }
    },
    "regression_baseline": {
      "type": "object",
      "description": "Baseline metrics for regression tracking",
      "required": ["iteration", "passed", "failed", "score"],
      "properties": {
        "iteration": {
          "type": "integer",
          "minimum": 1
        },
        "passed": {
          "type": "integer",
          "minimum": 0
        },
        "failed": {
          "type": "integer",
          "minimum": 0
        },
        "score": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        }
      }
    },
    "coverage": {
      "type": "object",
      "description": "Coverage metrics by failure mode category",
      "properties": {
        "injection": {"type": "integer", "minimum": 0},
        "boundary": {"type": "integer", "minimum": 0},
        "ambiguity": {"type": "integer", "minimum": 0},
        "type_error": {"type": "integer", "minimum": 0},
        "logic_error": {"type": "integer", "minimum": 0},
        "hallucination": {"type": "integer", "minimum": 0},
        "state_inconsistency": {"type": "integer", "minimum": 0},
        "infinite_loop": {"type": "integer", "minimum": 0}
      }
    },
    "missing_coverage": {
      "type": "array",
      "description": "Failure mode categories not yet covered by tests",
      "items": {
        "type": "string",
        "enum": [
          "injection",
          "boundary",
          "ambiguity",
          "type_error",
          "logic_error",
          "hallucination",
          "state_inconsistency",
          "infinite_loop"
        ]
      }
    },
    "test_cases": {
      "type": "array",
      "description": "Collection of adversarial test cases",
      "items": {
        "type": "object",
        "required": ["id", "description", "category", "input", "expected_behavior", "failure_mode", "severity", "iteration_added"],
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^ADV-\\d+-\\d+$",
            "description": "Unique test case identifier (ADV-{iteration}-{number})"
          },
          "description": {
            "type": "string",
            "description": "Human-readable test intent"
          },
          "category": {
            "type": "string",
            "enum": [
              "injection",
              "boundary",
              "ambiguity",
              "type_error",
              "logic_error",
              "hallucination",
              "state_inconsistency",
              "infinite_loop"
            ],
            "description": "Failure mode category"
          },
          "input": {
            "description": "Actual input to pass to the skill (string or structured object)",
            "oneOf": [
              {"type": "string"},
              {"type": "object"}
            ]
          },
          "expected_behavior": {
            "type": "string",
            "description": "What should happen (pass criteria)"
          },
          "failure_mode": {
            "type": "string",
            "description": "What specific weakness this targets"
          },
          "severity": {
            "type": "string",
            "enum": ["critical", "high", "medium", "low"],
            "description": "Impact severity of potential failure"
          },
          "iteration_added": {
            "type": "integer",
            "minimum": 1,
            "description": "Iteration number when test was added"
          },
          "status": {
            "type": "string",
            "enum": ["pending", "passed", "failed", "skipped"],
            "default": "pending",
            "description": "Current test status"
          },
          "last_run": {
            "type": "string",
            "format": "date-time",
            "description": "Timestamp of last execution"
          },
          "regression_test": {
            "type": "boolean",
            "default": false,
            "description": "Whether this is a regression test from previous iteration"
          },
          "execution_history": {
            "type": "array",
            "description": "History of test executions",
            "items": {
              "type": "object",
              "properties": {
                "iteration": {"type": "integer"},
                "timestamp": {"type": "string", "format": "date-time"},
                "status": {"type": "string", "enum": ["passed", "failed", "skipped"]},
                "actual_output": {"type": "string"},
                "error_message": {"type": "string"}
              }
            }
          }
        }
      }
    }
  }
}
